<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Bagas Trilaksonoaji">
<meta name="dcterms.date" content="2024-09-05">

<title>Research Project</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="CrossTrade_files/libs/clipboard/clipboard.min.js"></script>
<script src="CrossTrade_files/libs/quarto-html/quarto.js"></script>
<script src="CrossTrade_files/libs/quarto-html/popper.min.js"></script>
<script src="CrossTrade_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="CrossTrade_files/libs/quarto-html/anchor.min.js"></script>
<link href="CrossTrade_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="CrossTrade_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="CrossTrade_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="CrossTrade_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="CrossTrade_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="CrossTrade_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="CrossTrade_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#australian-stock-exchange" id="toc-australian-stock-exchange" class="nav-link" data-scroll-target="#australian-stock-exchange"><span class="header-section-number">1.1</span> Australian Stock Exchange</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data"><span class="header-section-number">1.2</span> Data</a></li>
  <li><a href="#topics" id="toc-topics" class="nav-link" data-scroll-target="#topics"><span class="header-section-number">1.3</span> Topics</a>
  <ul class="collapse">
  <li><a href="#hypothesis" id="toc-hypothesis" class="nav-link" data-scroll-target="#hypothesis"><span class="header-section-number">1.3.1</span> Hypothesis</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#data-1" id="toc-data-1" class="nav-link" data-scroll-target="#data-1"><span class="header-section-number">2</span> Data</a></li>
  <li><a href="#analysis" id="toc-analysis" class="nav-link" data-scroll-target="#analysis"><span class="header-section-number">3</span> Analysis</a>
  <ul class="collapse">
  <li><a href="#xt-vs-non-xt" id="toc-xt-vs-non-xt" class="nav-link" data-scroll-target="#xt-vs-non-xt"><span class="header-section-number">3.1</span> XT vs Non-XT</a></li>
  <li><a href="#price-impact" id="toc-price-impact" class="nav-link" data-scroll-target="#price-impact"><span class="header-section-number">3.2</span> Price Impact</a>
  <ul class="collapse">
  <li><a href="#xt-vs-all-non-xt" id="toc-xt-vs-all-non-xt" class="nav-link" data-scroll-target="#xt-vs-all-non-xt"><span class="header-section-number">3.2.1</span> XT vs All Non-XT</a></li>
  <li><a href="#xt-vs-matched-trades" id="toc-xt-vs-matched-trades" class="nav-link" data-scroll-target="#xt-vs-matched-trades"><span class="header-section-number">3.2.2</span> XT vs Matched Trades</a></li>
  </ul></li>
  <li><a href="#possible-topics" id="toc-possible-topics" class="nav-link" data-scroll-target="#possible-topics"><span class="header-section-number">3.3</span> Possible Topics</a>
  <ul class="collapse">
  <li><a href="#xt-for-cross-subsidization-of-funds-informed" id="toc-xt-for-cross-subsidization-of-funds-informed" class="nav-link" data-scroll-target="#xt-for-cross-subsidization-of-funds-informed"><span class="header-section-number">3.3.1</span> XT for cross-subsidization of funds (informed)</a></li>
  <li><a href="#xt-for-principal-profit-informed" id="toc-xt-for-principal-profit-informed" class="nav-link" data-scroll-target="#xt-for-principal-profit-informed"><span class="header-section-number">3.3.2</span> XT for principal profit (informed)</a></li>
  <li><a href="#price-impacting-xt-non-informed" id="toc-price-impacting-xt-non-informed" class="nav-link" data-scroll-target="#price-impacting-xt-non-informed"><span class="header-section-number">3.3.3</span> Price Impacting XT (non-informed)</a></li>
  <li><a href="#xt-for-transaction-fee-non-informed" id="toc-xt-for-transaction-fee-non-informed" class="nav-link" data-scroll-target="#xt-for-transaction-fee-non-informed"><span class="header-section-number">3.3.4</span> XT for transaction fee (non-informed))</a></li>
  </ul></li>
  <li><a href="#xt-statistics" id="toc-xt-statistics" class="nav-link" data-scroll-target="#xt-statistics"><span class="header-section-number">3.4</span> XT Statistics</a>
  <ul class="collapse">
  <li><a href="#price-improvement-statistics-on-january" id="toc-price-improvement-statistics-on-january" class="nav-link" data-scroll-target="#price-improvement-statistics-on-january"><span class="header-section-number">3.4.1</span> Price Improvement Statistics on January</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Research Project</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Bagas Trilaksonoaji </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 5, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<section id="australian-stock-exchange" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="australian-stock-exchange"><span class="header-section-number">1.1</span> Australian Stock Exchange</h2>
<p>ASX is an integrated exchange offering listings, trading, clearing, settlement, technical and information services, technology, data and other post-trade services.</p>
<p>It acts as a market operator, clearing house and payments system facilitator. It oversees compliance with its operating rules, promotes standards of corporate governance among Australiaâ€™s listed companies and helps to educate retail investors.</p>
<p>ASX operates markets for a wide range of asset classes including <strong>equities</strong>, fixed income, commodities and energy.</p>
</section>
<section id="data" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="data"><span class="header-section-number">1.2</span> Data</h2>
<p>Historical trade data in ASX from 2011 - 2015.</p>
<p>Initial: trade data of 1 stock in the year 2015.</p>
</section>
<section id="topics" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="topics"><span class="header-section-number">1.3</span> Topics</h2>
<p>Price Impact of Cross Trades</p>
<p>A <strong>cross trade</strong> occurs when both the buyer and seller sides of a trade are handled by the same broker.</p>
<p><strong>Price impact</strong> refers to the effect that a trade, or a series of trades, has on the market price of a stock. It measures how much the price of a stock moves as a result of trading activity.</p>
<section id="hypothesis" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="hypothesis"><span class="header-section-number">1.3.1</span> Hypothesis</h3>
<p>Cross trades have a greater price impact than regular trades because they are more information-driven.</p>
</section>
</section>
</section>
<section id="data-1" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Data</h1>
<p>1PG Trades Count (2015) by Qualifiers:</p>
<div class="cell" data-hash="CrossTrade_cache/html/unnamed-chunk-3_fa8c792928e74f996f2eb2b1fb7912b6">
<div class="cell-output-display">

<table quarto-disable-processing="true" class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> Qualifiers </th>
   <th style="text-align:right;"> count </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> AC </td>
   <td style="text-align:right;"> 5275 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AC XT </td>
   <td style="text-align:right;"> 360 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Bi </td>
   <td style="text-align:right;"> 103527 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> CX </td>
   <td style="text-align:right;"> 259 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> CX Bi </td>
   <td style="text-align:right;"> 1669 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> CX Si </td>
   <td style="text-align:right;"> 1825 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Si </td>
   <td style="text-align:right;"> 105222 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> XT Bi </td>
   <td style="text-align:right;"> 4060 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> XT Si </td>
   <td style="text-align:right;"> 4558 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>We do not care about Center Point trades, because they do not influence market price directly. Hence, take them out. We also do not need Auction trades. It leaves us with XT Bi, XT Si, Bi and Si Trades.</p>
<div class="cell" data-hash="CrossTrade_cache/html/unnamed-chunk-4_a1970bf325b85764263e2451d9441a7a">
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Qualifiers</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Bi</td>
<td style="text-align: right;">103429</td>
</tr>
<tr class="even">
<td style="text-align: left;">Si</td>
<td style="text-align: right;">105131</td>
</tr>
<tr class="odd">
<td style="text-align: left;">XT Bi</td>
<td style="text-align: right;">4059</td>
</tr>
<tr class="even">
<td style="text-align: left;">XT Si</td>
<td style="text-align: right;">4552</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="analysis" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Analysis</h1>
<section id="xt-vs-non-xt" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="xt-vs-non-xt"><span class="header-section-number">3.1</span> XT vs Non-XT</h2>
<div class="cell" data-hash="CrossTrade_cache/html/unnamed-chunk-5_50e1d63c72fd2871b36154f3659b8a45">
<div class="cell-output-display">
<p><img src="CrossTrade_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="price-impact" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="price-impact"><span class="header-section-number">3.2</span> Price Impact</h2>
<p>Price impact is measured using:</p>
<p>Absolute value of Natural logarithm of the ratio of the best bid-ask mid-quote 5 minutes after the Cross Trade, divided by the prevailing best bid-ask mid-quote at the time of the trade. <span class="math display">\[ PI5 = |ln(MidQuote_5/MidQuote_0)|\]</span></p>
<section id="xt-vs-all-non-xt" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="xt-vs-all-non-xt"><span class="header-section-number">3.2.1</span> XT vs All Non-XT</h3>
<div class="cell" data-hash="CrossTrade_cache/html/unnamed-chunk-9_e14946ac802bec4abee603c9ee1b426c">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 Ã— 2
  Qualifiers PI5_mean
  &lt;chr&gt;         &lt;dbl&gt;
1 Bi          0.00476
2 Si          0.00465
3 XT Bi       0.00501
4 XT Si       0.00499</code></pre>
</div>
</div>
<div class="cell" data-hash="CrossTrade_cache/html/unnamed-chunk-10_4c0f0df92a9b5956cb15784612de4d2e">
<div class="cell-output-display">
<p><img src="CrossTrade_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="xt-vs-matched-trades" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="xt-vs-matched-trades"><span class="header-section-number">3.2.2</span> XT vs Matched Trades</h3>
</section>
</section>
<section id="possible-topics" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="possible-topics"><span class="header-section-number">3.3</span> Possible Topics</h2>
<section id="xt-for-cross-subsidization-of-funds-informed" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="xt-for-cross-subsidization-of-funds-informed"><span class="header-section-number">3.3.1</span> XT for cross-subsidization of funds (informed)</h3>
<p>Characteristics:</p>
<ol type="1">
<li>Done by HFT brokers</li>
<li>XT happened more off the market (transfer the stocks after/before automated HFT)</li>
<li>XT happened:</li>
</ol>
<ul>
<li>After non-preferred funds (B) buying the stock from market. This could happened for transferring stock from non-preferred (B) to preferred funds (A).</li>
<li>After A buying the stock from market. This could happened for transferring stock from A to B.</li>
</ul>
<ol start="4" type="1">
<li>For control we need:</li>
</ol>
<ul>
<li>The XT volume should be similar to the buying volume before.</li>
<li>Time of buying before the XT should be not far away from the XT</li>
</ul>
<ol start="5" type="1">
<li>Absolute price impact is greater(?)</li>
</ol>
</section>
<section id="xt-for-principal-profit-informed" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="xt-for-principal-profit-informed"><span class="header-section-number">3.3.2</span> XT for principal profit (informed)</h3>
<p>Principal profit:</p>
<ul>
<li>move unwanted shares to clients</li>
<li>take wanted shares from clients</li>
</ul>
<p>Characteristics:</p>
<ol type="1">
<li>Done by retail brokers</li>
<li>XT happened more off the market</li>
</ol>
<ul>
<li>XT happened:
<ul>
<li>After brokers buying the stock from market. This could happened for moving unwanted stock to clients.</li>
<li>After clients buying the stock from the market. This could happened for taking wanted stocks clients.</li>
<li>Execution price similar than prevailing market price. In non-informed XT, usually premium/discount are exist, as buyer/seller wants to buy/sell desperately. Hence, if the premium/discount are non-existent, the other party may be given or have different information.</li>
</ul></li>
</ul>
<ol start="3" type="1">
<li>Absolute price impact is greater(?)</li>
</ol>
</section>
<section id="price-impacting-xt-non-informed" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="price-impacting-xt-non-informed"><span class="header-section-number">3.3.3</span> Price Impacting XT (non-informed)</h3>
<p>Characteristics:</p>
<ol type="1">
<li>Done by institutional brokers (high capital)</li>
<li>Happened on the market, hence impacting price</li>
<li>buy/ask order time and volume are similar (predetermined)</li>
<li>happened quite frequently in short period of time</li>
<li>very aggressive (absorb the liquidity)</li>
<li>price impact is greater(?)</li>
</ol>
</section>
<section id="xt-for-transaction-fee-non-informed" class="level3" data-number="3.3.4">
<h3 data-number="3.3.4" class="anchored" data-anchor-id="xt-for-transaction-fee-non-informed"><span class="header-section-number">3.3.4</span> XT for transaction fee (non-informed))</h3>
<ol type="1">
<li>Done by institutional and retail brokers</li>
<li>On-the-market. XT happened with similar volume and time of orders</li>
<li>Not as aggressive</li>
<li>price impact is not greater than regular trades</li>
</ol>
</section>
</section>
<section id="xt-statistics" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="xt-statistics"><span class="header-section-number">3.4</span> XT Statistics</h2>
<section id="price-improvement-statistics-on-january" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="price-improvement-statistics-on-january"><span class="header-section-number">3.4.1</span> Price Improvement Statistics on January</h3>
<div class="cell" data-hash="CrossTrade_cache/html/unnamed-chunk-17_74c1dbfbbb6b3bc3b43c29853973c8f6">
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">desc</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">count</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">percentage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">price improvement</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1.56</td>
</tr>
<tr class="even">
<td style="text-align: left;">best bid/ask</td>
<td style="text-align: right;">206</td>
<td style="text-align: right;">80.47</td>
</tr>
<tr class="odd">
<td style="text-align: left;">outside</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">17.97</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>