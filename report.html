<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Bagas Trilaksonoaji">
<meta name="dcterms.date" content="2024-10-25">

<title>Trade With Price Improvement</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="report_files/libs/clipboard/clipboard.min.js"></script>
<script src="report_files/libs/quarto-html/quarto.js"></script>
<script src="report_files/libs/quarto-html/popper.min.js"></script>
<script src="report_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="report_files/libs/quarto-html/anchor.min.js"></script>
<link href="report_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="report_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="report_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="report_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="report_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="report_files/libs/kePrint-0.0.1/kePrint.js"></script>

<link href="report_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">



</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#abstract" id="toc-abstract" class="nav-link active" data-scroll-target="#abstract"><span class="header-section-number">1</span> Abstract</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">2</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#background-and-motivation" id="toc-background-and-motivation" class="nav-link" data-scroll-target="#background-and-motivation"><span class="header-section-number">2.1</span> Background and Motivation</a></li>
  <li><a href="#purpose-and-key-questions" id="toc-purpose-and-key-questions" class="nav-link" data-scroll-target="#purpose-and-key-questions"><span class="header-section-number">2.2</span> Purpose and Key Questions</a>
  <ul class="collapse">
  <li><a href="#understand-the-impact-on-at-the-spread-crossings" id="toc-understand-the-impact-on-at-the-spread-crossings" class="nav-link" data-scroll-target="#understand-the-impact-on-at-the-spread-crossings"><span class="header-section-number">2.2.1</span> Understand the Impact on At-the-Spread Crossings</a></li>
  <li><a href="#identify-the-violation-pattern" id="toc-identify-the-violation-pattern" class="nav-link" data-scroll-target="#identify-the-violation-pattern"><span class="header-section-number">2.2.2</span> Identify the Violation Pattern</a></li>
  </ul></li>
  <li><a href="#significance-and-contributions-500" id="toc-significance-and-contributions-500" class="nav-link" data-scroll-target="#significance-and-contributions-500"><span class="header-section-number">2.3</span> Significance and Contributions 500</a>
  <ul class="collapse">
  <li><a href="#economic-significance" id="toc-economic-significance" class="nav-link" data-scroll-target="#economic-significance"><span class="header-section-number">2.3.1</span> Economic Significance</a></li>
  <li><a href="#regulatory-significance" id="toc-regulatory-significance" class="nav-link" data-scroll-target="#regulatory-significance"><span class="header-section-number">2.3.2</span> Regulatory Significance</a></li>
  <li><a href="#academic-significance" id="toc-academic-significance" class="nav-link" data-scroll-target="#academic-significance"><span class="header-section-number">2.3.3</span> Academic Significance</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#data-and-methodology-1000" id="toc-data-and-methodology-1000" class="nav-link" data-scroll-target="#data-and-methodology-1000"><span class="header-section-number">3</span> Data and Methodology 1000</a></li>
  <li><a href="#result-and-discussion-2000" id="toc-result-and-discussion-2000" class="nav-link" data-scroll-target="#result-and-discussion-2000"><span class="header-section-number">4</span> Result and Discussion 2000</a>
  <ul class="collapse">
  <li><a href="#analysis" id="toc-analysis" class="nav-link" data-scroll-target="#analysis"><span class="header-section-number">4.1</span> Analysis</a>
  <ul class="collapse">
  <li><a href="#logistic-regression" id="toc-logistic-regression" class="nav-link" data-scroll-target="#logistic-regression"><span class="header-section-number">4.1.1</span> Logistic Regression</a></li>
  <li><a href="#random-forest" id="toc-random-forest" class="nav-link" data-scroll-target="#random-forest"><span class="header-section-number">4.1.2</span> Random Forest</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">4.1.3</span> Summary</a></li>
  <li><a href="#limitation" id="toc-limitation" class="nav-link" data-scroll-target="#limitation"><span class="header-section-number">4.1.4</span> Limitation</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#conclusion-500" id="toc-conclusion-500" class="nav-link" data-scroll-target="#conclusion-500"><span class="header-section-number">5</span> Conclusion 500</a>
  <ul class="collapse">
  <li><a href="#potential-future-work" id="toc-potential-future-work" class="nav-link" data-scroll-target="#potential-future-work"><span class="header-section-number">5.1</span> Potential Future Work</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">6</span> References</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Trade With Price Improvement</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Bagas Trilaksonoaji </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 25, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div style="page-break-after: always;"></div>
<section id="abstract" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Abstract</h1>
</section>
<section id="introduction" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Introduction</h1>
<p>There were numerous equities exchanges established in the long history of Australia. Almost every big city in Australia once had their own stock exchange, namely Sydney, Brisbane, Melbourne, Adelaide, Perth, and even Hobart. The Australian Parliament merged all six stock exchanges in 1987, creating the Australian Stock Exchange <a href="https://www.asx.com.au/about/asx-story">(Australian Stock Exchange, n.d.)</a>. Two decades later, this equities exchange merged with Sydney Futures Exchange to become the Australian Securities Exchange. Although its official name is now ASX Limited, it is more convenient to simply refer to it as ASX. In this report, however, we will use the term ASX to refer to the company or the equities market.</p>
<p>As a market operator, ASX’s main tasks include reviewing listing applications, supervising listed entities as well as listed brokers, operating and maintaining an electronic trading platform for buying and selling stocks, and providing clearing and settlement services. <a href="https://www.asx.com.au/about#:~:text=As%20an%20integrated%20exchange%2C%20ASX's,equities%20and%20fixed%20income%20markets.">(Australian Stock Exchange, n.d.)</a>.</p>
<p>ASX operates under the regulatory framework of two government agencies, the Australia Securities and Investments Commission (ASIC) and the Reserve Bank of Australia (RBA) <a href="https://www.asx.com.au/about/regulation">(Australian Stock Exchange, n.d.)</a>. ASIC oversees stock market trading and enforces financial market conduct laws, while the Reserve Bank of Australia (RBA) oversees clearing and settlement-related services.</p>
<section id="background-and-motivation" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="background-and-motivation"><span class="header-section-number">2.1</span> Background and Motivation</h2>
<p>Anyone who wants to buy or sell stocks can place an order on the ASX trading platform. When the price of the buy and sell side matches, the trade can be executed. Outstanding orders will remain on the platform and visible to market participants. This mechanism promotes transparency and market equilibrium in supply and demand, thereby ensuring fair stock price formation <a href="https://asic.gov.au/about-asic/corporate-publications/newsletters/market-integrity-update/miu-issue-137-may-2022/">(Australian Securities and Investments Commission, 2022)</a>. That is why we often call this trading venue provided by the ASX trading platform <code>lit market</code> or <code>lit pool</code>.</p>
<p>On the other hand, there are other venues that do not disclose the orders placed, at least until the transaction is executed. We will use the term <code>dark pool</code> to refer to this kind of trading venue. There are several <code>dark pools</code> available for stock trading in Australia. However, in this project, we will focus on the <code>dark pool</code> executed on the broker’s internal crossing system.</p>
<p>Crossing system is an electronic platform provided by the brokers to match orders placed by their clients with their other clients or with their own account <a href="https://download.asic.gov.au/media/1344596/rep394-published-19-May-2014.pdf">(Australian Securities and Investments Commission, 2014)</a>. In other words, orders can be matched on the broker’s internal system before they are passed through to the ASX trading platform. For the next section, we will use the term <code>crossing</code> to refer to the trades in the broker’s internal crossing system.</p>
<p>What is the benefit for brokers and traders if they trade on the crossing system instead of the ASX <code>lit pool</code>? One of the primary benefits is the significantly lower trading fees. Trades on the ASX platform are charged about 0.15 basis points per trade, whereas internal crossing charges as much as 0.04 basis points per trade, capped at $1,000 per month <a href="https://asxonline.com/content/dam/asxonline/public/documents/schedule-of-fees/asx-trade-markets-participant-and-trading-schedule-of-fees.pdf">(Australian Securities Exchange, 2024)</a>). The difference is quite huge given how much a broker can trade on a daily basis.</p>
<p>It is important to note that the internal crossing rule differed before and after 26 May 2013.</p>
<ol type="1">
<li><p><strong>Before</strong></p>
<p>Based on Rule 4.2.3(1)(b) of the ASIC Market Integrity Rules (Competition in Exchange Markets) 2011, the trades done in the broker’s internal crossing system are referred to as <code>Trades At or Within the Spread</code>. As the name suggests, the executed trade price must be at the same as the best available bid or best available offer of the <code>lit market</code> (at-the-spread), or better (within-the-spread). This implies that the price executed in this “dark pool” cannot be lower than the best bid price or higher than the best offer price in the “lit market”.</p></li>
<li><p><strong>After</strong></p>
<p>The rule had changed, based on Rule 4.2.3 of the ASIC Market Integrity Rules (Competition in Exchange Markets) Amendment 2012 (No.&nbsp;1), the trades on the crossing system must provide meaningful price improvement <a href="https://download.asic.gov.au/media/1344596/rep394-published-19-May-2014.pdf">(Australian Securities and Investments Commission, 2014)</a>. Trades at the best bid or best offer price of the <code>lit market</code> are not in the option anymore. This rule was effective on 26 May 2013. ASIC and ASX refer to this internal crossing trade as <code>Trades With Price Improvement</code>, or next we can refer to this as TWPI. This report will specifically focus on this type of dark trading.</p></li>
</ol>
<p>The amendment of the rule in May 2013 was to address the negative impact of the dark trades on the price formation, specifically from the <code>at-the-spread</code> trades <a href="https://download.asic.gov.au/media/1344596/rep394-published-19-May-2014.pdf">(Australian Securities and Investments Commission, 2014)</a>, due to traders may prefer to do the trades on the <code>dark pool</code> as it costs less fees compared to the <code>lit pool</code>. The adverse effect on price discovery was one of the main reasons why the regulator wanted more trading to occur in the <code>lit pool</code>.</p>
<p>On the other hand, the ASX was also motivated by an economic incentive. On October 14, 1998, ASX became a publicly owned company after demutualising itself. The main analysis behind this was that “<em>ASX needed to become more flexible, responsive, and commercially focused, capable of quickly taking up emerging commercial opportunities</em>” <a href="https://asic.gov.au/about-asic/news-centre/speeches/market-demutualisation-and-privatisation-the-australian-experience/">(Australian Securities and Investments Commission, 2004)</a>. Therefore, ASX, being an all-for-profit enterprise, would seize any business opportunity to increase its revenue and maximize its returns to shareholders. ASIC amended the rules to provide meaningful price improvements, which would shift a significant portion of dark trades to the ASX platform, thereby increasing its profit from trading fees.</p>
<p><strong>Key Motivation</strong></p>
<p>In May 2022, ASIC published a Market Integrity Update (Issue 137), which included a review of TWPI. In the article, ASIC mentioned that several participants were reporting a significant number of their TWPIs without any price improvement. ASIC emphasized that such trades must be done in the <code>lit market</code> because they will promote liquidity and price formation. TWPI is an exception because it offers better prices for the investor—a price that the <code>lit market</code> cannot provide.</p>
<p>Following up on the Market Integrity Update, ASIC issued an infringement notice to Wilson Advisory and Stockbroking Pty Ltd, requiring them to pay $548,328 to ASIC on behalf of the Commonwealth. The notice was given on 16 December 2022, while published on an ASIC media release on 3 February 2023.</p>
<p>The penalty shows that ASIC has started to take the breach of the TWPI rule more seriously. However, despite the rule’s lengthy introduction (in 2011 and amended in 2013), ASIC’s concern didn’t surface until recently. Therefore, I’m intrigued to analyse the TWPI trades following the amendment on 26 May 2013. Were there no violations of the TWPI rule in its early establishment? Or were there other factors that prevented the regulator from taking this issue seriously?</p>
<p>Apparently, according to an ASIC report from 2014 <a href="https://download.asic.gov.au/media/1344596/rep394-published-19-May-2014.pdf">(Report 394)</a>, the rule change in May 2013 increased the proportion of trading on the <code>lit market</code>, enhanced the fairness on the market price formation. ASIC seems to be satisfied with this finding and may have become less vigilant, or at least not yet, in enforcing the TWPI rule among market participants.</p>
</section>
<section id="purpose-and-key-questions" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="purpose-and-key-questions"><span class="header-section-number">2.2</span> Purpose and Key Questions</h2>
<p>The main objective of this study is to look into how the rule change in 2013 affected <code>at-the-spread</code> crossings reported as TWPI. The way brokers act and trade on the <code>dark pool</code> should be greatly affected by this change, as they must move the <code>at-the-spread</code> crossings to the <code>lit pool</code>. Moreover, this study will also examine the violation of the TWPI after the rule change, as this is the key motivation of this study.</p>
<p>The study will compare transaction data before and after the 2013 regulation change, with a focus on TWPI and <code>at-the-spread</code> crossings. Trade volumes, prices, time stamps, broker IDs, and several other variables will be included in the analysis. There will be simple statistical methods used to compare trade distributions, and machine learning methods may be used to find trends of the violations in the TWPI rule.</p>
<section id="understand-the-impact-on-at-the-spread-crossings" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="understand-the-impact-on-at-the-spread-crossings"><span class="header-section-number">2.2.1</span> Understand the Impact on At-the-Spread Crossings</h3>
<p><code>At-the-spread</code> crossings were possible before the rule change, which meant that trades could be made at the best bid or best offer price available on the <code>lit market</code>. However, the 2013 amendment says that trades must lead to price improvements, in other words, <code>at-the-spread</code> crossings are no longer allowed. The main question is the number of <code>at-the-spread</code> crossings among all TWPI-reported trades before and after 26 May 2013. This comparison will help to figure out whether the rule change stopped people from doing <code>at the spread</code> crossings at the <code>dark pool</code>.</p>
<p><strong>Key Question</strong>: Did the number of <code>at-the-spread</code> crossings drop significantly after 26 May 2013?</p>
</section>
<section id="identify-the-violation-pattern" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="identify-the-violation-pattern"><span class="header-section-number">2.2.2</span> Identify the Violation Pattern</h3>
<p>ASIC’s media release and publication in the last couple of years suggested that there have been TWPI rule violations in recent years. This study will examine the monetary worth of the violations, identify which brokers do the most violations, and find any pattern by creating a model to help spot non-compliance in the future.</p>
<p><strong>Key Question</strong>:</p>
<ol type="1">
<li>How many violations, both in terms of the quantity of trades and the dollar value, occurred following the rule change?</li>
<li>What kind of brokers violate the rules the most? Are some brokers more likely to break TWPI rules than others?</li>
<li>What conditions contributed to the occurrence of the violations?</li>
</ol>
</section>
</section>
<section id="significance-and-contributions-500" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="significance-and-contributions-500"><span class="header-section-number">2.3</span> Significance and Contributions 500</h2>
<p>There are three main areas in which this study may contribute: academic, regulatory, and economic.</p>
<section id="economic-significance" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="economic-significance"><span class="header-section-number">2.3.1</span> Economic Significance</h3>
<p>From a financial point of view, it is essential to comprehend TWPI violations since they have the potential to compromise market integrity in general <a href="https://download.asic.gov.au/media/1344596/rep394-published-19-May-2014.pdf">(Australian Securities and Investments Commission, 2014)</a>. By figuring out how much value in dollar TWPI violations occurred, this study can show how much value was traded not in a legal manner. If these trades had taken place on the <code>lit market</code>, then there would be trading fees that should be paid to the market operator (ASX). Internal crossing trades, for example, incur a fee of approximately 0.04 basis points per trade, whereas trades on the ASX platform cost 0.15 basis points per trade <a href="https://asxonline.com/content/dam/asxonline/public/documents/schedule-of-fees/asx-trade-markets-participant-and-trading-schedule-of-fees.pdf">(Australian Securities and Investments Commission, 2024)</a>. This significant difference in trading fees indicates additional economic implications.</p>
</section>
<section id="regulatory-significance" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="regulatory-significance"><span class="header-section-number">2.3.2</span> Regulatory Significance</h3>
<p>Understanding the magnitude of the TWPI violation since its amendment in 2013 may provide regulators with new insights to address the TWPI reporting issues at the prevention level rather than through corrective action. Furthermore, if the detection model developed in this study proves effective, regulators might utilize it as part of an automated enforcement mechanism to ensure TWPI reporting follows the regulations.</p>
</section>
<section id="academic-significance" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="academic-significance"><span class="header-section-number">2.3.3</span> Academic Significance</h3>
<p>There is a lot of academic literature on special orders and hidden orders, but this study adds a new dimension by focusing on TWPI violations. This study’s novel contribution is the use of a prediction model to identify patterns and conditions that result in TWPI rule violations. The study might help academics learn more about how rules are enforced in financial markets and the situations where traders are most likely to take advantage of the system loopholes.</p>
</section>
</section>
</section>
<section id="data-and-methodology-1000" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Data and Methodology 1000</h1>
</section>
<section id="result-and-discussion-2000" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Result and Discussion 2000</h1>
<section id="analysis" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="analysis"><span class="header-section-number">4.1</span> Analysis</h2>
<section id="logistic-regression" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="logistic-regression"><span class="header-section-number">4.1.1</span> Logistic Regression</h3>
<p>Confusion Matrix and Statistics of <code>at-the-spread</code> violations on the test dataset:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction      0      1
         0 732681   4539
         1 307566   9697
                                          
               Accuracy : 0.704           
                 95% CI : (0.7031, 0.7049)
    No Information Rate : 0.9865          
    P-Value [Acc &gt; NIR] : 1               
                                          
                  Kappa : 0.0335          
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.70433         
            Specificity : 0.68116         
         Pos Pred Value : 0.99384         
         Neg Pred Value : 0.03056         
             Prevalence : 0.98650         
         Detection Rate : 0.69482         
   Detection Prevalence : 0.69913         
      Balanced Accuracy : 0.69275         
                                          
       'Positive' Class : 0               
                                          </code></pre>
</div>
</div>
<p>Confusion Matrix and Statistics of <code>outside-spread</code> violations on the test dataset:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction      0      1
         0 614494  10555
         1 399606  29828
                                         
               Accuracy : 0.611          
                 95% CI : (0.6101, 0.612)
    No Information Rate : 0.9617         
    P-Value [Acc &gt; NIR] : 1              
                                         
                  Kappa : 0.0613         
                                         
 Mcnemar's Test P-Value : &lt;2e-16         
                                         
            Sensitivity : 0.60595        
            Specificity : 0.73863        
         Pos Pred Value : 0.98311        
         Neg Pred Value : 0.06946        
             Prevalence : 0.96170        
         Detection Rate : 0.58274        
   Detection Prevalence : 0.59275        
      Balanced Accuracy : 0.67229        
                                         
       'Positive' Class : 0              
                                         </code></pre>
</div>
</div>
<section id="apply-model-to-twpi-data-outside-broker-210-and-361" class="level4" data-number="4.1.1.1">
<h4 data-number="4.1.1.1" class="anchored" data-anchor-id="apply-model-to-twpi-data-outside-broker-210-and-361"><span class="header-section-number">4.1.1.1</span> Apply model to twpi data outside broker 210 and 361</h4>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.670172</code></pre>
</div>
</div>
<p>Confusion Matrix and Statistics of <code>at-the-spread</code> violations on the new dataset:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction      0      1
         0 726112   3076
         1 309217   5445
                                          
               Accuracy : 0.7008          
                 95% CI : (0.6999, 0.7017)
    No Information Rate : 0.9918          
    P-Value [Acc &gt; NIR] : 1               
                                          
                  Kappa : 0.0181          
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.7013          
            Specificity : 0.6390          
         Pos Pred Value : 0.9958          
         Neg Pred Value : 0.0173          
             Prevalence : 0.9918          
         Detection Rate : 0.6956          
   Detection Prevalence : 0.6986          
      Balanced Accuracy : 0.6702          
                                          
       'Positive' Class : 0               
                                          </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6502005</code></pre>
</div>
</div>
<p>Confusion Matrix and Statistics of <code>outside-spread</code> violations on the new dataset:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction      0      1
         0 599398   4200
         1 429565  10687
                                          
               Accuracy : 0.5845          
                 95% CI : (0.5835, 0.5854)
    No Information Rate : 0.9857          
    P-Value [Acc &gt; NIR] : 1               
                                          
                  Kappa : 0.0199          
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.58253         
            Specificity : 0.71787         
         Pos Pred Value : 0.99304         
         Neg Pred Value : 0.02427         
             Prevalence : 0.98574         
         Detection Rate : 0.57422         
   Detection Prevalence : 0.57824         
      Balanced Accuracy : 0.65020         
                                          
       'Positive' Class : 0               
                                          </code></pre>
</div>
</div>
</section>
</section>
<section id="random-forest" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="random-forest"><span class="header-section-number">4.1.2</span> Random Forest</h3>
<section id="at-the-spread" class="level4" data-number="4.1.2.1">
<h4 data-number="4.1.2.1" class="anchored" data-anchor-id="at-the-spread"><span class="header-section-number">4.1.2.1</span> At-The-Spread</h4>
<p>Variable importance of <code>at-the-spread</code> violations:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                       0         1 MeanDecreaseAccuracy MeanDecreaseGini
DollarValue    59.007187 100.40460            131.27640         2617.498
AskVol_before 146.211349 287.26167            393.89538         4729.450
BidVol_before 142.931942 286.48835            364.34268         4790.141
Volume         49.769757 103.75083            134.10499         2248.948
spread        230.996712 431.11889            589.67343         8098.680
Date           12.170909  65.69846             59.37895         2057.638
Hour           40.580342  51.03897             66.12206         1264.557
Dayofweek       8.310214  49.13468             42.56112         1139.813</code></pre>
</div>
</div>
<p>Confusion Matrix and Statistics of <code>at-the-spread</code> violations on the test dataset:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction      0      1
         0 825008   2571
         1 215239  11665
                                          
               Accuracy : 0.7934          
                 95% CI : (0.7927, 0.7942)
    No Information Rate : 0.9865          
    P-Value [Acc &gt; NIR] : 1               
                                          
                  Kappa : 0.0732          
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.79309         
            Specificity : 0.81940         
         Pos Pred Value : 0.99689         
         Neg Pred Value : 0.05141         
             Prevalence : 0.98650         
         Detection Rate : 0.78238         
   Detection Prevalence : 0.78482         
      Balanced Accuracy : 0.80625         
                                          
       'Positive' Class : 0               
                                          </code></pre>
</div>
</div>
</section>
<section id="outside-the-spread" class="level4" data-number="4.1.2.2">
<h4 data-number="4.1.2.2" class="anchored" data-anchor-id="outside-the-spread"><span class="header-section-number">4.1.2.2</span> Outside the Spread</h4>
<p>Variable importance of <code>outside-the-spread</code> violation:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                      0        1 MeanDecreaseAccuracy MeanDecreaseGini
DollarValue   125.50860 157.4889             217.4215         6946.841
AskVol_before 204.88930 413.4406             504.1273        15512.206
BidVol_before 242.37856 432.8081             517.8487        15926.278
Volume        133.80397 150.5007             204.1081         6561.616
spread        171.97334 601.5576             720.5479        16535.967
Date           51.70494 261.0853             258.5334         7005.261
Hour           85.76693 130.0931             144.6198         3594.039
Dayofweek      32.07256 241.1619             236.0054         3561.868</code></pre>
</div>
</div>
<p>Confusion Matrix and Statistics of <code>outside-spread</code> violations on the test dataset:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction      0      1
         0 851631   6737
         1 162469  33646
                                          
               Accuracy : 0.8395          
                 95% CI : (0.8388, 0.8402)
    No Information Rate : 0.9617          
    P-Value [Acc &gt; NIR] : 1               
                                          
                  Kappa : 0.236           
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.8398          
            Specificity : 0.8332          
         Pos Pred Value : 0.9922          
         Neg Pred Value : 0.1716          
             Prevalence : 0.9617          
         Detection Rate : 0.8076          
   Detection Prevalence : 0.8140          
      Balanced Accuracy : 0.8365          
                                          
       'Positive' Class : 0               
                                          </code></pre>
</div>
</div>
</section>
<section id="apply-model-to-twpi-data-outside-broker-210-and-361-1" class="level4" data-number="4.1.2.3">
<h4 data-number="4.1.2.3" class="anchored" data-anchor-id="apply-model-to-twpi-data-outside-broker-210-and-361-1"><span class="header-section-number">4.1.2.3</span> Apply model to twpi data outside broker 210 and 361</h4>
<p>Confusion Matrix and Statistics of <code>at-the-spread</code> violations on the new dataset:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction      0      1
         0 791298   1906
         1 244031   6615
                                          
               Accuracy : 0.7644          
                 95% CI : (0.7636, 0.7652)
    No Information Rate : 0.9918          
    P-Value [Acc &gt; NIR] : 1               
                                          
                  Kappa : 0.0358          
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.76430         
            Specificity : 0.77632         
         Pos Pred Value : 0.99760         
         Neg Pred Value : 0.02639         
             Prevalence : 0.99184         
         Detection Rate : 0.75806         
   Detection Prevalence : 0.75988         
      Balanced Accuracy : 0.77031         
                                          
       'Positive' Class : 0               
                                          </code></pre>
</div>
</div>
<p>Confusion Matrix and Statistics of <code>outside-spread</code> violations on the new dataset:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction      0      1
         0 863004   4861
         1 165959  10026
                                          
               Accuracy : 0.8364          
                 95% CI : (0.8356, 0.8371)
    No Information Rate : 0.9857          
    P-Value [Acc &gt; NIR] : 1               
                                          
                  Kappa : 0.0809          
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.83871         
            Specificity : 0.67347         
         Pos Pred Value : 0.99440         
         Neg Pred Value : 0.05697         
             Prevalence : 0.98574         
         Detection Rate : 0.82675         
   Detection Prevalence : 0.83141         
      Balanced Accuracy : 0.75609         
                                          
       'Positive' Class : 0               
                                          </code></pre>
</div>
</div>
</section>
</section>
<section id="summary" class="level3" data-number="4.1.3">
<h3 data-number="4.1.3" class="anchored" data-anchor-id="summary"><span class="header-section-number">4.1.3</span> Summary</h3>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Violation</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">GLM_top2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">GLM_others</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">RF_top2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">RF_others</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">at-spread</td>
<td style="text-align: right;">0.6927471</td>
<td style="text-align: right;">0.6701720</td>
<td style="text-align: right;">0.8062450</td>
<td style="text-align: right;">0.7703068</td>
</tr>
<tr class="even">
<td style="text-align: left;">outside-spread</td>
<td style="text-align: right;">0.6722889</td>
<td style="text-align: right;">0.6502005</td>
<td style="text-align: right;">0.8364812</td>
<td style="text-align: right;">0.7560929</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="limitation" class="level3" data-number="4.1.4">
<h3 data-number="4.1.4" class="anchored" data-anchor-id="limitation"><span class="header-section-number">4.1.4</span> Limitation</h3>
</section>
</section>
</section>
<section id="conclusion-500" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Conclusion 500</h1>
<section id="potential-future-work" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="potential-future-work"><span class="header-section-number">5.1</span> Potential Future Work</h2>
</section>
</section>
<section id="references" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> References</h1>
<p>ASIC Market Integrity Rules (Competition in Exchange Markets) 2011.</p>
<p>Australian Securities and Investments Commission. (20 May 2004). <em>Market demutualisation and privatisation: The Australian experience</em> [Speech]. Retrieved 24 October 2024, from https://asic.gov.au/about-asic/news-centre/speeches/market-demutualisation-and-privatisation-the-australian-experience/</p>
<p>Australian Securities and Investments Commission. (May 2014). <em>Report 394: Review of recent rule changes affecting dark liquidity</em> (PDF). Retrieved 24 October 2024, from https://download.asic.gov.au/media/1344596/rep394-published-19-May-2014.pdf</p>
<p>Australian Securities and Investments Commission. (May 2022). <em>Market integrity update: Issue 137</em>. Retrieved 24 October 2024, from https://asic.gov.au/about-asic/corporate-publications/newsletters/market-integrity-update/miu-issue-137-may-2022/</p>
<p>Australian Securities and Investments Commission. (3 February 2023). <em>Wilson’s Advisory and Stockbroking Ltd ACN 010 529 665 pays $548,328 infringement notice</em> [Media release]. Retrieved 24 October 2024, from https://asic.gov.au/about-asic/news-centre/find-a-media-release/2023-releases/23-016mr-wilsons-advisory-and-stockbroking-ltd-acn-010-529-665-pays-548-328-infringement-notice/</p>
<p>Australian Securities Exchange. (n.d.). ASX regulatory framework. Retrieved 24 October 2024, from https://www.asx.com.au/about/regulation</p>
<p>Australian Securities Exchange. (n.d.). ASX story. Retrieved 24 October 2024, from https://www.asx.com.au/about/asx-story</p>
<p>Australian Securities Exchange. (n.d.). About Us. Retrieved 24 October 2024, from https://www.asx.com.au/about#:~:text=As%20an%20integrated%20exchange%2C%20ASX’s,equities%20and%20fixed%20income%20markets.</p>
<p>Australian Securities Exchange. (19 February 2024). <em>ASX Trade: Markets Participant and Trading Schedule of Fees</em> (PDF). Retrieved 24 October 2024, from https://asxonline.com/content/dam/asxonline/public/documents/schedule-of-fees/asx-trade-markets-participant-and-trading-schedule-of-fees.pdf</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>